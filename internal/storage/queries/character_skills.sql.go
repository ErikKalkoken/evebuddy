// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.26.0
// source: character_skills.sql

package queries

import (
	"context"
	"strings"
)

const deleteExcludedCharacterSkills = `-- name: DeleteExcludedCharacterSkills :exec
DELETE FROM character_skills
WHERE my_character_id = ?
AND eve_type_id NOT IN (/*SLICE:eve_type_ids*/?)
`

type DeleteExcludedCharacterSkillsParams struct {
	MyCharacterID int64
	EveTypeIds    []int64
}

func (q *Queries) DeleteExcludedCharacterSkills(ctx context.Context, arg DeleteExcludedCharacterSkillsParams) error {
	query := deleteExcludedCharacterSkills
	var queryParams []interface{}
	queryParams = append(queryParams, arg.MyCharacterID)
	if len(arg.EveTypeIds) > 0 {
		for _, v := range arg.EveTypeIds {
			queryParams = append(queryParams, v)
		}
		query = strings.Replace(query, "/*SLICE:eve_type_ids*/?", strings.Repeat(",?", len(arg.EveTypeIds))[1:], 1)
	} else {
		query = strings.Replace(query, "/*SLICE:eve_type_ids*/?", "NULL", 1)
	}
	_, err := q.db.ExecContext(ctx, query, queryParams...)
	return err
}

const getCharacterSkill = `-- name: GetCharacterSkill :one
SELECT
    character_skills.active_skill_level, character_skills.eve_type_id, character_skills.skill_points_in_skill, character_skills.my_character_id, character_skills.trained_skill_level,
    eve_types.id, eve_types.description, eve_types.eve_group_id, eve_types.name, eve_types.is_published,
    eve_groups.id, eve_groups.eve_category_id, eve_groups.name, eve_groups.is_published,
    eve_categories.id, eve_categories.name, eve_categories.is_published
FROM character_skills
JOIN eve_types ON eve_types.id = character_skills.eve_type_id
JOIN eve_groups ON eve_groups.id = eve_types.eve_group_id
JOIN eve_categories ON eve_categories.id = eve_groups.eve_category_id
WHERE my_character_id = ?
AND eve_type_id = ?
`

type GetCharacterSkillParams struct {
	MyCharacterID int64
	EveTypeID     int64
}

type GetCharacterSkillRow struct {
	CharacterSkill CharacterSkill
	EveType        EveType
	EveGroup       EveGroup
	EveCategory    EveCategory
}

func (q *Queries) GetCharacterSkill(ctx context.Context, arg GetCharacterSkillParams) (GetCharacterSkillRow, error) {
	row := q.db.QueryRowContext(ctx, getCharacterSkill, arg.MyCharacterID, arg.EveTypeID)
	var i GetCharacterSkillRow
	err := row.Scan(
		&i.CharacterSkill.ActiveSkillLevel,
		&i.CharacterSkill.EveTypeID,
		&i.CharacterSkill.SkillPointsInSkill,
		&i.CharacterSkill.MyCharacterID,
		&i.CharacterSkill.TrainedSkillLevel,
		&i.EveType.ID,
		&i.EveType.Description,
		&i.EveType.EveGroupID,
		&i.EveType.Name,
		&i.EveType.IsPublished,
		&i.EveGroup.ID,
		&i.EveGroup.EveCategoryID,
		&i.EveGroup.Name,
		&i.EveGroup.IsPublished,
		&i.EveCategory.ID,
		&i.EveCategory.Name,
		&i.EveCategory.IsPublished,
	)
	return i, err
}

const listCharacterSkills = `-- name: ListCharacterSkills :many
SELECT active_skill_level, eve_type_id, skill_points_in_skill, my_character_id, trained_skill_level
FROM character_skills
WHERE my_character_id = ?
`

func (q *Queries) ListCharacterSkills(ctx context.Context, myCharacterID int64) ([]CharacterSkill, error) {
	rows, err := q.db.QueryContext(ctx, listCharacterSkills, myCharacterID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []CharacterSkill
	for rows.Next() {
		var i CharacterSkill
		if err := rows.Scan(
			&i.ActiveSkillLevel,
			&i.EveTypeID,
			&i.SkillPointsInSkill,
			&i.MyCharacterID,
			&i.TrainedSkillLevel,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateOrCreateCharacterSkill = `-- name: UpdateOrCreateCharacterSkill :exec
INSERT INTO character_skills (
    my_character_id,
    eve_type_id,
    active_skill_level,
    skill_points_in_skill,
    trained_skill_level
)
VALUES (
    ?1, ?2, ?3, ?4, ?5
)
ON CONFLICT(my_character_id, eve_type_id) DO
UPDATE SET
    active_skill_level = ?3,
    skill_points_in_skill = ?4,
    trained_skill_level = ?5
WHERE my_character_id = ?1
AND eve_type_id = ?2
`

type UpdateOrCreateCharacterSkillParams struct {
	MyCharacterID      int64
	EveTypeID          int64
	ActiveSkillLevel   int64
	SkillPointsInSkill int64
	TrainedSkillLevel  int64
}

func (q *Queries) UpdateOrCreateCharacterSkill(ctx context.Context, arg UpdateOrCreateCharacterSkillParams) error {
	_, err := q.db.ExecContext(ctx, updateOrCreateCharacterSkill,
		arg.MyCharacterID,
		arg.EveTypeID,
		arg.ActiveSkillLevel,
		arg.SkillPointsInSkill,
		arg.TrainedSkillLevel,
	)
	return err
}
